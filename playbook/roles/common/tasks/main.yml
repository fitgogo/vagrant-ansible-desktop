---
- name: disable ipv6
  lineinfile: >
    dest="/etc/sysctl.conf"
    line="{{ item }}"
  with_items:
    - "net.ipv6.conf.all.disable_ipv6 = 1"
    - "net.ipv6.conf.default.disable_ipv6 = 1"
    - "net.ipv6.conf.eth0.disable_ipv6 = 1"
    - "net.ipv6.conf.lo.disable_ipv6 = 1"
  register: sysctl_ipv6

- name: sysctl load
  command: sysctl --load
  when: sysctl_ipv6 is changed

- name: change mirror
  replace: >
    dest="/etc/apt/sources.list"
    regexp="http://(archive|security)\.ubuntu\.com/ubuntu(.+)"
    replace="http://ftp.jaist.ac.jp/pub/Linux/ubuntu\2"
  register: apt_mirror

- name: apt update
  apt: update_cache=yes
  when: apt_mirror is changed

- name: aptitude upgrade
  apt: upgrade=full state=latest
  when: apt_mirror is changed

- name: install language-pack
  apt: 
    name: ['language-pack-ja', 'language-pack-gnome-ja', 'thunderbird-locale-ja', 'fonts-takao', 'ibus-anthy', 'ibus-mozc']
  environment:
    DEBIAN_FRONTEND: "noninteractive"
  register: install_language_pack

- name: update locale
  command: update-locale LANG="ja_JP.UTF-8"
  when: install_language_pack is changed

- name: update localtime
  file: >
    dest="/etc/localtime"
    src="/usr/share/zoneinfo/Asia/Tokyo"
    state=link
    force=yes

